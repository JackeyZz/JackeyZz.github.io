---
title: java编程思想-对象
date: 2018-11-02 13:47:35
tags: [java]
categories: [java整理总结]
---
![](java编程思想-对象/Java-对象.png)
## 对象、对象引用、句柄
```java
Light it = new Light();
it.on();
```
上述例子中，类的名称为`Light`，调用`new`方法创建类`Light`的新对象，然后用对象引用`it`关联创建的新对象。`.on()`作为类对象的接口，向对象发出请求执行任务。
通常对象需要关联引用才能够传递消息，执行任务；引用可以单独存在。
### 对象的定义
在Java里面，对象有五大基本特性
- 万物皆为对象：不仅仅是基本数据变量，可以是任何概念化构件
- 程序是对象的集合，通过发送消息来告知彼此所要做的                             
- 每个对象都有自己的由其他对象所构成的存储
- 每个对象都是某个类的一个实例
- 某一特定类型的所有对象都可以接受同样的消息

HotSpot虚拟机中，对象在内存中存储的布局可以分为三块区域：对象头(Header)、实例数据(Instance Data)和对齐填充(Padding)
![](java编程思想-对象/pic1.png)
从上面的这张图里面可以看出，对象在内存中的结构主要包含以下几个部分：
- Mark Word(标记字段)：对象的Mark Word部分占4个字节，其内容是一系列的标记位，比如轻量级锁的标记位，偏向锁标记位等等。
- class Pointer（Class对象指针）：Class对象指针的大小也是4个字节，其指向的位置是对象对应的Class对象（其对应的元数据对象）的内存地址
- 对象实际数据：这里面包括了对象的所有成员变量，其大小由各个成员变量的大小决定，比如：byte和boolean是1个字节，short和char是2个字节，int和float是4个字节，long和double是8个字节，reference是4个字节
- 对齐：最后一部分是对齐填充的字节，按8个字节填充。
### 对象引用
java中的引用类型可分为：
- 强引用：默认的引用类型，例如`StringBuffer buffer = new StringBuffer()`，就是`buffer`变量持有的为`StringBuilder`的强引用类型。
- 软引用：即`SoftReference`，其指向的对象只有在内存不足的时候进行回收。
- 弱引用：即`WeakReference`,其指向的对象在GC执行时会被回收。
- 虚引用：即`PhantomReference`,与`ReferenceQueue`结合，用作记录该引用指向的对象已被销毁。

java虚拟机(JVM)是通过某些数据类型来执行计算的，其数据类型可分为：基本类型、引用类型和null类型。其中引用类型可分为：
- 类类型：对类实例的引用
- 接口类型：对实现了该接口的某个类实例的引用
- 数组类型：对数组对象的引用，在JVM中，数组是个真正的对象

JVM数据访问方式：
- 句柄形式：引用指向句柄，句柄包含对象地址和对象类型
- 指针：直接存储对象地址
指针比句柄少一步，访问更快；但是值发生改变时，前者引用不用变，后者要改变指针。

## 对象的创建
### 如何创建
```java
  String s = new String("hello world");
```
通常用`new`操作符来创建一个新的对象。

### 存储位置
Java数据存储位置：
- 寄存器：位于处理器内部，速度最快，数量有限，按需求分配，无法在程序中直接控制
- 堆栈：位于通用RAM(随机访问存储器)中，由堆栈指针控制分配，往上释放往下分配，故需要了解堆栈中数据的生命周期。存储数据有对象引用等
- 堆：通用的内存池(位于RAM区)，用于存放所有的Java对象，不需要了解生命周期，执行`new`时自动在堆中分配存储
- 常量存储：存放在代码内部
- 非RAM存储：把对象转化成可以存放在其他媒介上的事物，如流对象(对象转换成字节流发送至其他机器)和持久化对象(存放至磁盘)

### 特例：基本类型
当`new`创建一个特别小且简单的变量对象(如基本数据类型int、char、long等等)时存储至堆中，往往不是很有效，因此不用`new`来创建变量，而是创建一个并非是引用的“自动”变量，这个变量直接存储“值”，并置于堆栈中。
```java
  char c = 'x';
  Character ch = new Character(c);
```
其中变量`c`为基本数据类型，存储在堆栈中，而通过`Character(c)`的自动装箱功能自动地将基本类型转换成包装器类型，存储在堆中。
高精度数字：`BigInteger`和`BigDecimal`

### 特例：数组
- 数组的安全性：Java确保数组会被初始化，而且不能在它的范围之外被访问。这种范围检查，是以每个数组上少量的内存开销及运行时的下标检查为代价的
- 创建一个数组对象时，实际上就是创建一个引用数组，并且每个引用都会自动被初始化为一个特定值，该值拥有自己的关键字null。在使用任何引用前，必须为其指定一个对象。

## 对象的销毁
### 作用域
作用域由花括号的位置决定。
```java
  {
    int x = 12;
    // only x is available
    {
      int q = 30;
      // both x and q are available
    }
    // q is out of scope
    // only x is available
  }
```
而作用域里定义的变量只可用于作用域结束之前

### 对象的作用域
Java对象与基本类型的生命周期不一样，当`new`创建一个Java对象时，它可以存活于作用域之外。
```java
  {
    String s = new String("hello world");
  }
```
引用`s`在作用域终点就消失了，但是`s`指向的`String`对象仍继续占据内存空间。这就涉及到如何在作用域外传递和复制对象引用。

### 对象的销毁
Java存在一个垃圾回收器，用以监视用`new`创建的所有对象，并辨别那些不会再被引用的对象，随后释放这些对象的内存空间，以便供其他新的对象使用，消除了内存泄漏问题。

## 数据类型：类
### 字段
字段有时被称为数据成员
- 任何类型的对象，通过引用与其进行通信，必须初始化该引用，以便关联实际对象
- 基本类型的一种

每个对象都有用来存储其字段的空间，普通字段不能在对象间共享。可以通过“引用名称.变量名称”进行字段赋值。
若类的某个成员是基本数据类型，则其存在一个默认值，但这并不适用于局部变量(及并非是某个类的字段),如某个方法中定义了`int x;`，那么`x`的值可能为任意值。
### 方法
java的方法决定了一个对象能够接受什么样的消息，其基本组成部分为：名称、参数、返回值和方法体

### 名字可见性
反转域名确定唯一性
### static关键字
通过static关键字满足以下两种需求：
- 为某特定域分配单一存储空间，不考虑对象
- 希望某个方法不于包含它的类的任何对象关联在一起，即没有创建对象也可以调用这个方法

```java
Class StaticTest{
  static int i = 48;
}
StaticTest st1 = new StaticTest();
StaticTest st2 = new StaticTest();
```
此时`st1.i`与`st2.i`指向同一存储空间。
引用static变量既可以使用对象引用去定位，也可以使用类名去定位，如`StaticTest.i`
